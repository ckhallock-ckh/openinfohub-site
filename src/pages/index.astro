---
import BaseLayout from "../layouts/BaseLayout.astro";

// Pull all pages that export `frontmatter`
// NOTE: This assumes article pages use:
// export const frontmatter = { title, description, tags, updated, canonical };
const modules = import.meta.glob("./pest-control/**/index.astro", { eager: true });

// Build a list of pages (excluding the hub itself)
const allPages = Object.entries(modules)
  .map(([path, mod]) => {
    const fm = mod.frontmatter ?? {};

    // Fallbacks if a module exposes metadata via exports instead of frontmatter
    const pageTitle = fm.title ?? mod.title ?? null;
    const canonical = fm.canonical ?? mod.canonical ?? null;

    if (!pageTitle || !canonical) return null;

    return {
      path,
      title: pageTitle,
      description: fm.description ?? mod.description ?? "",
      tags: fm.tags ?? mod.tags ?? [],
      updated: fm.updated ?? mod.updated ?? "1970-01-01",
      canonical,
    };
  })
  .filter(Boolean)
  // exclude the hub page itself
  .filter((p) => !String(p.canonical).endsWith("/pest-control/"))
  // newest first
  .sort((a, b) => String(b.updated).localeCompare(String(a.updated)));

const latest = allPages.slice(0, 8);

// Cluster cards
const clusters = [
  {
    title: "Pest Control",
    href: "/pest-control/",
    desc: "Groundhogs, burrows, prevention, and when to call a pro.",
  },
];

const title = "Home";
const description =
  "OpenInfoHub provides clear, practical answers to common homeowner questions—organized by topic and easy to skim.";
const canonical = "https://openinfohub.net/";
const updated = "2026-01-16";
---

<BaseLayout title={title} description={description} canonical={canonical} updated={updated}>
  <h1 style="margin:0 0 8px;">OpenInfoHub</h1>
  <p style="margin:0 0 18px; color:#cbd5e1;">
    Clear, practical answers for homeowner problems—organized by topic. No fluff, just what to do next.
  </p>

  <section style="margin-bottom:18px;">
    <h2 style="margin:0 0 10px; font-size:18px;">What to expect</h2>
    <ul style="margin:0; padding-left:18px; color:#cbd5e1;">
      <li>Direct answer first, then steps and common mistakes.</li>
      <li>Safety-first order of operations (don’t trap animals inside, don’t create odors, etc.).</li>
      <li>We keep pages skimmable with tables, checklists, and FAQs.</li>
    </ul>
  </section>

  <section style="margin-bottom:18px;">
    <h2 style="margin:0 0 10px; font-size:18px;">Start here</h2>

    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); gap:12px;">
      {clusters.map((c) => (
        <a
          href={c.href}
          style="display:block; text-decoration:none; border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:14px; background:rgba(255,255,255,.02);"
        >
          <div style="font-weight:700; color:#e5e7eb; margin-bottom:6px;">{c.title}</div>
          <div style="font-size:13px; color:#9ca3af; line-height:1.5;">{c.desc}</div>
        </a>
      ))}
    </div>
  </section>

  <section style="margin-bottom:18px;">
    <h2 style="margin:0 0 10px; font-size:18px;">Latest answers</h2>

    <div style="border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:14px; background:rgba(255,255,255,.02);">
      {latest.length === 0 ? (
        <p style="margin:0; color:#9ca3af;">New answers will appear here as pages are published.</p>
      ) : (
        <ul style="margin:0; padding-left:18px;">
          {latest.map((p) => (
            <li style="margin:0 0 10px;">
              <a href={new URL(p.canonical).pathname} style="font-weight:600;">
                {p.title}
              </a>
              {p.description ? (
                <div style="font-size:13px; color:#9ca3af; margin-top:3px;">
                  {p.description}
                </div>
              ) : null}
            </li>
          ))}
        </ul>
      )}
    </div>
  </section>

  <section style="border:1px dashed rgba(255,255,255,.20); border-radius:12px; padding:14px;">
    <h2 style="margin:0 0 8px; font-size:18px;">Browse topics</h2>
    <p style="margin:0 0 10px; color:#9ca3af;">
      Start with Pest Control, then we’ll expand into other homeowner categories as the site grows.
    </p>
    <a href="/pest-control/" style="font-weight:700;">Go to Pest Control →</a>
  </section>
</BaseLayout>

